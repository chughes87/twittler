<!DOCTYPE html>
<html>
  <head>
    <title>CSS demo</title>
    <link rel="stylesheet" href="styles.css" />
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <script src="moment.min.js"></script>
    <script src="handlebars-v1.1.2.js"></script>
    <script id="tweet-template" type="text/x-handlebars-template">
      <span id="user">@{{user_name}}</span>
      <span id="time">{{time}}</span>
      <br />
      <span id="message">{{message}}</span>
    </script>
    <meta charset="utf-8">

  </head>
  <body>
    <script>
      var add_tweets = function(tweets) {
        var $body = $('body');
        $body.html('');

        var tweet_html;
        var $tweet; 

        var source = $("#tweet-template").html();
        var template = Handlebars.compile(source);
        var context;

        for(var i = 0; i < tweets.length; i++){
          $tweet = $('<div id="tweet"></div>');
          context = {user_name: tweets[i].user, time: moment(tweets[i].created_at).fromNow(), message: tweets[i].message};
          tweet_html = template(context);
          $tweet.html(tweet_html);
          $tweet.prependTo($body);
        }
      }

      var refresh = function(previousCount) {
        var currentCount = streams.home.length;
        if( currentCount > previousCount){
          add_tweets(streams.home);
        }
        return currentCount;
      }

      $(document).ready(function(){
        var tweetCount = 0;
        setInterval(function(){
          tweetCount = refresh(tweetCount);
        }, 3000);
      });

    </script>
  </body>
</html>
