<!DOCTYPE html>
<html>
  <head>
    <title>Twittler</title>
    <link rel="stylesheet" href="styles.css" />
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <script src="moment.min.js"></script>
    <script src="handlebars-v1.1.2.js"></script>
    <script id="tweet-template" type="text/x-handlebars-template">
      <span id="user">@{{user_name}}</span>
      <span id="time">{{time}}</span>
      <br />
      <span id="message">{{message}}</span>
    </script>
    <meta charset="utf-8">

  </head>
  <body>
    <script>
      var selected_user = "shawndrost";

      var add_tweets = function(tweets, column) {

        var $column = $('#'+column);
        $column.html('');

        var tweet_html;
        var $tweet; 

        var source = $("#tweet-template").html();
        var template = Handlebars.compile(source);
        var context;

        for(var i = 0; i < tweets.length; i++){
          $tweet = $('<div id="tweet" style="clear: both;"></div>');
          context = {
            column_name: column
            ,user_name: tweets[i].user
            ,time: moment(tweets[i].created_at).fromNow()
            ,message: tweets[i].message
          };
          tweet_html = template(context);
          $tweet.html(tweet_html);
          $tweet.prependTo($column);
        }
      }

      var clear_tweets = function(column) {
        var $column = $('#'+column);
        $column.html('');
      }

      var refresh = function() {//previous_total) {
        add_tweets(streams.home.slice(-10), "left-column");
        if( selected_user !== ""){
          add_tweets(streams.users[selected_user].slice(-10), "right-column");
        }else{
          clear_tweets("right-column");
        }
      }

      $(document).ready(function(){
        setInterval(function(){
          refresh();
        }, 3000);

        $('#user').click(function() {
          selected_user = this.html().slice(1);
        });
      });

    </script>
    <div id="left-column"></div>
    <div id="right-column"></div>
  </body>
</html>
